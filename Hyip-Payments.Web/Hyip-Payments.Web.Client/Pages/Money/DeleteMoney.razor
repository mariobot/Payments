@page "/deletemoney/{Id:int}"
@using System.Net.Http.Json
@using Hyip_Payments.Models
@inject HttpClient Http
@inject NavigationManager NavigationManager

<h3>Delete Money</h3>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}
else if (money == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="alert alert-warning">
        <strong>Are you sure you want to delete this money record?</strong>
    </div>
    <dl class="row">
        <dt class="col-sm-2">Amount</dt>
        <dd class="col-sm-10">@money.Amount</dd>
        <dt class="col-sm-2">Currency</dt>
        <dd class="col-sm-10">@money.Currency</dd>
        <dt class="col-sm-2">Country</dt>
        <dd class="col-sm-10">@money.Country</dd>
    </dl>
    <button class="btn btn-danger" @onclick="DeleteMoney2">Delete</button>
    <button class="btn btn-secondary" @onclick="GoBack">Cancel</button>
}

@code {
    [Parameter]
    public int Id { get; set; }

    private MoneyModel? money;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var response = await Http.GetAsync($"api/money/{Id}");
            if (response.IsSuccessStatusCode)
            {
                money = await response.Content.ReadFromJsonAsync<MoneyModel>();
            }
            else if (response.StatusCode == System.Net.HttpStatusCode.NotFound)
            {
                errorMessage = "Money record not found.";
            }
            else
            {
                errorMessage = $"Error loading money record (Status: {(int)response.StatusCode}).";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"An error occurred: {ex.Message}";
        }
    }

    private async Task DeleteMoney2()
    {
        var response = await Http.DeleteAsync($"api/money/{Id}");
        if (response.IsSuccessStatusCode)
        {
            NavigationManager.NavigateTo("/moneylist");
        }
        else
        {
            errorMessage = "Failed to delete the money record.";
        }
    }

    private void GoBack()
    {
        NavigationManager.NavigateTo("/moneylist");
    }
}
