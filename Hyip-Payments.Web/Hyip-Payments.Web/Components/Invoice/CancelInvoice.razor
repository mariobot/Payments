@using Hyip_Payments.Context
@using Hyip_Payments.Models
@using Hyip_Payments.Web.Data
<h3>Cancel Invoice</h3>

@if (invoice == null)
{
    <div>Loading invoice...</div>
}
else
{
    <div class="alert alert-warning">
        <p>Are you sure you want to cancel the invoice <strong>@invoice.InvoiceNumber</strong>?</p>
        <button class="btn btn-danger" @onclick="CancelInvoice2">Cancel Invoice</button>
        <button class="btn btn-secondary" @onclick="NavigateBack">Back</button>
    </div>
}

@code {
    [Parameter]
    public int InvoiceId { get; set; }

    private InvoiceModel? invoice;

    [Inject]
    private PaymentsDbContext DbContext { get; set; } = default!;

    [Inject]
    private NavigationManager NavigationManager { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        // Load the invoice by ID
        invoice = await DbContext.Invoices.FindAsync(InvoiceId);

        if (invoice == null)
        {
            // Handle case where invoice is not found
            NavigationManager.NavigateTo("/InvoiceList");
        }
    }

    private async Task CancelInvoice2()
    {
        if (invoice != null)
        {
            invoice.IsActive = false; // Mark the invoice as inactive
            DbContext.Invoices.Update(invoice);
            await DbContext.SaveChangesAsync();

            // Navigate back to the invoice list
            NavigationManager.NavigateTo("/InvoiceList");
        }
    }

    private void NavigateBack()
    {
        NavigationManager.NavigateTo("/InvoiceList");
    }
}
